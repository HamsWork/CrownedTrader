{% extends 'signals/base.html' %}

{% block title %}Signal Types - Crowned Trader Dashboard{% endblock %}

{% block extra_css %}
<style>
    .st-page {
        width: 100%;
        max-width: 1840px;
        margin: 0 auto;
    }

    .st-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 20px;
        margin-bottom: 28px;
    }

    .st-title h1 {
        color: #e8ecff;
        font-size: 2.2em;
        font-weight: 800;
        margin: 0 0 10px 0;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .st-title-icon {
        width: 28px;
        height: 28px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        color: var(--accent);
        filter: drop-shadow(0 10px 22px rgba(var(--accent-rgb), 0.18));
        flex: 0 0 auto;
    }

    .st-title-icon svg {
        width: 22px;
        height: 22px;
        display: block;
    }

    .st-title p {
        margin: 0;
        color: rgba(232, 236, 255, 0.65);
        font-size: 1.05em;
    }

    .st-create-btn {
        background: var(--accent);
        color: #0b1020;
        border: none;
        border-radius: 12px;
        padding: 12px 18px;
        font-weight: 700;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        box-shadow: 0 10px 26px rgba(var(--accent-rgb), 0.18);
        transition: transform 160ms ease, box-shadow 160ms ease, background 160ms ease;
        white-space: nowrap;
        height: 44px;
    }

    .st-create-btn:hover {
        transform: translateY(-1px);
        background: color-mix(in srgb, var(--accent) 85%, #ffffff 15%);
        box-shadow: 0 14px 30px rgba(var(--accent-rgb), 0.22);
    }

    .st-section {
        margin-top: 26px;
    }

    .st-section-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 14px;
    }

    .st-section-header h2 {
        margin: 0;
        color: #e8ecff;
        font-size: 1.25em;
        font-weight: 800;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .st-lock {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 22px;
        height: 22px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(42, 55, 95, 0.55);
        color: rgba(232, 236, 255, 0.75);
        margin-left: 6px;
        transform: translateY(1px);
        flex: 0 0 auto;
    }

    .st-lock svg {
        width: 14px;
        height: 14px;
        display: block;
    }

    .st-pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 3px 12px;
        height: 22px;
        border-radius: 999px;
        border: 1px solid rgba(var(--accent-rgb), 0.55);
        background: rgba(0, 0, 0, 0.35);
        color: rgba(232, 236, 255, 0.82);
        font-size: 12px;
        font-weight: 800;
        letter-spacing: 0.01em;
        box-shadow:
            inset 0 1px 0 rgba(255, 255, 255, 0.08),
            0 10px 18px rgba(0, 0, 0, 0.25);
    }

    .st-pill strong {
        color: var(--accent);
        font-weight: 800;
    }

    .st-divider {
        height: 1px;
        background: rgba(255, 255, 255, 0.08);
        margin: 10px 0 16px 0;
    }

    .st-grid {
        display: grid;
        grid-template-columns: repeat(3, minmax(340px, 1fr));
        gap: 22px;
    }

    .st-card {
        position: relative;
        background: rgba(15, 23, 42, 0.72);
        border: 1px solid rgba(42, 55, 95, 0.55);
        border-radius: 16px;
        padding: 22px;
        padding-bottom: 78px; /* reserve for bottom action bar */
        overflow: hidden;
        transition: transform 160ms ease, border-color 160ms ease;
        min-height: 260px;
    }

    .st-card::after {
        content: "";
        position: absolute;
        right: -60px;
        top: -60px;
        width: 160px;
        height: 160px;
        border-radius: 50%;
        /* Fallback (kept subtle) */
        background: radial-gradient(circle at 30% 30%, rgba(147, 51, 234, 0.10), rgba(147, 51, 234, 0));
        pointer-events: none;
    }

    /* Right-side glow depends on signal color */
    @supports (color: color-mix(in srgb, #000 50%, #fff)) {
        .st-card::after {
            background: radial-gradient(
                circle at 30% 30%,
                color-mix(in srgb, var(--glow-color, #9333ea) 12%, transparent),
                transparent
            );
        }
    }

    .st-card:hover {
        transform: translateY(-2px);
        border-color: rgba(42, 55, 95, 0.85);
    }

    .st-card-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 12px;
        margin-bottom: 12px;
    }

    .st-card-title {
        margin: 0;
        color: #e8ecff;
        font-weight: 800;
        font-size: 1.1em;
    }

    .st-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: rgba(232, 236, 255, 0.35);
        flex: 0 0 auto;
        box-shadow: 0 0 0 6px rgba(255, 255, 255, 0.03);
    }

    .st-badges {
        display: flex;
        gap: 8px;
        margin-top: 10px;
        flex-wrap: wrap;
    }

    .st-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 10px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: rgba(10, 16, 35, 0.55);
        color: rgba(232, 236, 255, 0.78);
        font-size: 0.82em;
        font-weight: 700;
    }

    .st-badge.system {
        border-color: rgba(var(--accent-rgb), 0.45);
        color: var(--accent);
    }

    .st-badge.custom {
        border-color: rgba(96, 165, 250, 0.35);
        color: rgba(147, 197, 253, 0.95);
    }

    .st-badge.active {
        border-color: rgba(16, 185, 129, 0.35);
        color: rgba(52, 211, 153, 0.95);
    }

    .st-metrics {
        margin-top: 16px;
        display: grid;
        grid-template-columns: 1fr auto;
        row-gap: 12px;
        column-gap: 14px;
        color: rgba(232, 236, 255, 0.65);
        font-size: 0.92em;
    }

    .st-metrics .val {
        color: #e8ecff;
        font-weight: 700;
        justify-self: end;
    }

    .st-actions {
        position: absolute;
        left: 22px;
        right: 22px;
        bottom: 18px;
        display: flex;
        gap: 10px;
    }

    .st-action-divider {
        position: absolute;
        left: 22px;
        right: 22px;
        bottom: 66px; /* sits just above the bottom action bar */
        height: 1px;
        background: rgba(255, 255, 255, 0.08);
    }

    .st-btn.with-icon {
        gap: 8px;
    }

    .st-btn.with-icon svg {
        width: 16px;
        height: 16px;
        display: block;
        opacity: 0.95;
    }

    .st-btn {
        flex: 1;
        height: 40px;
        border-radius: 12px;
        border: 1px solid rgba(42, 55, 95, 0.55);
        background: rgba(255, 255, 255, 0.06);
        color: #e8ecff;
        font-weight: 700;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        transition: background 160ms ease, border-color 160ms ease;
    }

    .st-btn:hover {
        background: rgba(255, 255, 255, 0.06);
        border-color: rgba(42, 55, 95, 0.85);
    }

    .st-btn.danger {
        color: #ff4d4d;
        border-color: transparent;
        background: transparent;
    }

    .st-btn.danger:hover {
        background: rgba(255, 77, 77, 0.10);
        border-color: rgba(255, 77, 77, 0.40);
    }

    .st-create-card {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        border: 2px dashed rgba(42, 55, 95, 0.55);
        background: rgba(15, 23, 42, 0.45);
        text-decoration: none;
        padding-bottom: 22px; /* don't reserve action bar space */
        cursor: pointer;
    }

    .st-create-card::before,
    .st-create-card::after {
        display: none;
    }

    .st-create-card .plus {
        width: 64px;
        height: 64px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid rgba(42, 55, 95, 0.55);
        display: grid;
        place-items: center;
        font-size: 32px;
        color: rgba(232, 236, 255, 0.75);
        margin: 0 auto 16px auto;
    }

    .st-create-card h3 {
        margin: 0 0 6px 0;
        color: #e8ecff;
        font-size: 1.1em;
        font-weight: 800;
    }

    .st-create-card p {
        margin: 0;
        color: rgba(232, 236, 255, 0.65);
        max-width: 240px;
        font-size: 0.92em;
        line-height: 1.35;
    }

    .st-create-card:hover {
        border-color: rgba(42, 55, 95, 0.85);
        background: rgba(15, 23, 42, 0.55);
    }

    @media (max-width: 1200px) {
        .st-grid {
            grid-template-columns: repeat(2, minmax(0, 1fr));
        }
    }

    @media (max-width: 768px) {
        .st-header {
            flex-direction: column;
            align-items: flex-start;
        }
        .st-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="st-page">
    <div class="st-header">
        <div class="st-title">
            <h1>
                <span class="st-title-icon" aria-hidden="true">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
                        <path fill="currentColor" d="M234.7 42.7L197 56.8c-3 1.1-5 4-5 7.2s2 6.1 5 7.2l37.7 14.1L248.8 123c1.1 3 4 5 7.2 5s6.1-2 7.2-5l14.1-37.7L315 71.2c3-1.1 5-4 5-7.2s-2-6.1-5-7.2L277.3 42.7 263.2 5c-1.1-3-4-5-7.2-5s-6.1 2-7.2 5L234.7 42.7zM46.1 395.4c-18.7 18.7-18.7 49.1 0 67.9l34.6 34.6c18.7 18.7 49.1 18.7 67.9 0L529.9 116.5c18.7-18.7 18.7-49.1 0-67.9L495.3 14.1c-18.7-18.7-49.1-18.7-67.9 0L46.1 395.4zM484.6 82.6l-105 105-23.3-23.3 105-105 23.3 23.3zM7.5 117.2C3 118.9 0 123.2 0 128s3 9.1 7.5 10.8L64 160l21.2 56.5c1.7 4.5 6 7.5 10.8 7.5s9.1-3 10.8-7.5L128 160l56.5-21.2c4.5-1.7 7.5-6 7.5-10.8s-3-9.1-7.5-10.8L128 96 106.8 39.5C105.1 35 100.8 32 96 32s-9.1 3-10.8 7.5L64 96 7.5 117.2zm352 256c-4.5 1.7-7.5 6-7.5 10.8s3 9.1 7.5 10.8L416 416l21.2 56.5c1.7 4.5 6 7.5 10.8 7.5s9.1-3 10.8-7.5L480 416l56.5-21.2c4.5-1.7 7.5-6 7.5-10.8s-3-9.1-7.5-10.8L480 352l-21.2-56.5c-1.7-4.5-6-7.5-10.8-7.5s-9.1 3-10.8 7.5L416 352l-56.5 21.2z"/>
                    </svg>
                </span>
                <span>Signal Type Templates</span>
            </h1>
            <p>Manage custom and default templates for your trading signals.</p>
        </div>
    </div>

    <div class="st-section">
        <div class="st-section-header">
            <h2>Your Custom Signal Types <span class="st-pill"><strong>{{ user_signal_types|length }}</strong> Active</span></h2>
        </div>
        <div class="st-divider"></div>

        <div class="st-grid">
            {% for signal_type in user_signal_types %}
            <div class="st-card" style="--glow-color: {{ signal_type.color }};">
                <div class="st-card-header">
                    <div>
                        <div class="st-card-title">{{ signal_type.name }}</div>
                        <div class="st-badges">
                            <span class="st-badge custom">Custom</span>
                            <span class="st-badge active">Active</span>
                        </div>
                    </div>
                    <span class="st-dot" style="background: {{ signal_type.color }};"></span>
                </div>

                <div class="st-metrics">
                    <div>Variables</div><div class="val">{{ signal_type.variables|length }}</div>
                    <div>Fields</div><div class="val">{{ signal_type.fileds_template|length }}</div>
                    <div>Last Edited</div><div class="val">{{ signal_type.updated_at|timesince }} ago</div>
                </div>

                <div class="st-actions">
                    <a class="st-btn" href="{% url 'signal_type_edit' signal_type.id %}">Edit</a>
                    <a class="st-btn danger" href="{% url 'signal_type_delete' signal_type.id %}" onclick="return confirm('Are you sure you want to delete signal type \"{{ signal_type.name }}\"?');">Delete</a>
                </div>
            </div>
            {% endfor %}

            <a class="st-card st-create-card" href="{% url 'signal_type_create' %}">
                <div>
                    <div class="plus">ï¼‹</div>
                    <h3>Create New Template</h3>
                    <p>Define a new signal structure with custom fields.</p>
                </div>
            </a>
        </div>
    </div>

    {% if system_signal_types %}
    <div class="st-section" style="margin-top: 34px;">
        <div class="st-section-header">
            <h2>
                System Default Signal Types
                <span class="st-lock" aria-hidden="true" title="System templates are read-only">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path fill="currentColor" d="M17 9h-1V7a4 4 0 0 0-8 0v2H7a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-8a2 2 0 0 0-2-2Zm-7-2a2 2 0 1 1 4 0v2h-4V7Zm7 12H7v-8h10v8Z"/>
                    </svg>
                </span>
            </h2>
        </div>
        <div class="st-divider"></div>

        <div class="st-grid">
            {% for signal_type in system_signal_types %}
            <div class="st-card" style="--glow-color: {{ signal_type.color }};">
                <div class="st-card-header">
                    <div>
                        <div class="st-card-title">{{ signal_type.name }}</div>
                        <div class="st-badges">
                            <span class="st-badge system">System</span>
                        </div>
                    </div>
                    <span class="st-dot" style="background: {{ signal_type.color }};"></span>
                </div>

                <div class="st-metrics">
                    <div>Variables</div><div class="val">{{ signal_type.variables|length }}</div>
                    <div>Fields</div><div class="val">{{ signal_type.fileds_template|length }}</div>
                </div>

                <div class="st-action-divider" aria-hidden="true"></div>
                <div class="st-actions">
                    <a class="st-btn with-icon" href="{% url 'signal_type_edit' signal_type.id %}" title="View system template (read-only)">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true">
                            <path fill="currentColor" d="M12 5c5.5 0 9.8 4 11 7-1.2 3-5.5 7-11 7S2.2 15 1 12c1.2-3 5.5-7 11-7zm0 2c-4.4 0-7.9 3.1-8.9 5 1 1.9 4.5 5 8.9 5s7.9-3.1 8.9-5c-1-1.9-4.5-5-8.9-5z"/>
                            <path fill="currentColor" d="M12 9a3 3 0 1 1 0 6 3 3 0 0 1 0-6z"/>
                        </svg>
                        <span>View Details</span>
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

