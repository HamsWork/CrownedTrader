# Generated by Django 4.2.7 on 2025-10-28 15:41

from django.db import migrations


def create_default_signal_types(apps, schema_editor):
    """Create default signal types with their templates"""
    SignalType = apps.get_model('signals', 'SignalType')
    
    default_types = [
        {
            'name': 'Trade Alert',
            'variables': [
                {'name': 'ticker', 'type': 'string', 'label': 'Ticker Symbol', 'required': True},
                {'name': 'is_shares', 'type': 'boolean', 'label': 'Is Shares', 'required': False},
                {'name': 'strike', 'type': 'float', 'label': 'Strike', 'required': True},
                {'name': 'expiration', 'type': 'date', 'label': 'Expiration', 'required': True},
                {'name': 'option_type', 'type': 'select', 'options': ['PUT', 'CALL'], 'default': 'CALL', 'label': 'Option Type', 'required': True},
                {'name': 'price', 'type': 'float', 'label': 'Price', 'required': True},
                {'name': 'targets', 'type': 'text', 'label': 'Targets', 'required': True, 'hint': 'Enter Targets (e.g. $29.22 (+20.0%), $31.66 (+30.0%), $34.09 (+40.0%))'},
                {'name': 'stop_loss', 'type': 'text', 'label': 'Stop Loss', 'required': True, 'hint': 'Enter Stop Loss (e.g. $17.04 (-30%))'},
                {'name': 'trade_detail', 'type': 'text', 'label': 'Trade Detail', 'hint': 'Enter Trade Detail (e.g.\n Take Profit (1): At 20% take off 50% of position and tighten up stop loss to slightly above break even\nTake Profit (2): At 30% take off 50% of remaining position and set a 15% trailing stop loss for the remaining runners.)'},
                {'name': 'risk_management', 'type': 'text', 'label': 'Risk Management', 'hint': 'Enter Risk Management (e.g.\n 1. Avoid holding 0DTE/1DTE past 3PM ET unless momentum is explosive\n2. Control Position Size\n3. Do your own due diligence. This is not a suggestion to buy, sell or hold)'},
            ],
            'title_template': 'üö® {{ticker}} Trade Alert',
            'description_template': (
                'BTO(Buy to Open)\n'
            ),
            'show_title': False,
            'show_description': False,
            'color': '#0000FF',
            'fileds_template': [
                {
                    'name': 'üü¢ Ticker: {{ticker}}',
                    'value': '',
                    'inline': False,
                    'optional': False
                },
                {
                    'name': '',
                    'value': '\u200b',
                    'inline': False,
                    'optional': False
                },
                {
                    'name': '‚ùå Expiration',
                    'value': '{{expiration}}',
                    'inline': True,
                    'optional': False
                },
                {
                    'name': '‚úçÔ∏è Strike',
                    'value': '{{strike}} {{option_type}}',
                    'inline': True,
                    'optional': False
                },
                {
                    'name': 'üíµ Price',
                    'value': '${{price}}',
                    'inline': True,
                    'optional': True
                },
                {
                    'name': '',
                    'value': '\u200b',
                    'inline': False,
                    'optional': False
                },
                {
                    'name': 'üìù **Game Plan**',
                    'value': '',
                    'inline': False,
                    'optional': False
                },
                {
                    'name': 'üéØ Targets: {{targets}}',
                    'value': '',
                    'inline': False,
                    'optional': False
                },
                {
                    'name': 'üõë Stop Loss: {{stop_loss}}',
                    'value': '',
                    'inline': False,
                    'optional': False
                },
                {
                    'name': '',
                    'value': '\u200b',
                    'inline': False,
                    'optional': False
                },
                
                {
                    'name': 'üí∞ **Trade Detail**',
                    'value': '{{trade_detail}}',
                    'inline': False,
                    'optional': False
                },
                {
                    'name': '',
                    'value': '\u200b',
                    'inline': False,
                    'optional': False
                },
                {
                    'name': '‚ö†Ô∏è Risk Management',
                    'value': '{{risk_management}}',
                    'inline': False,
                    'optional': True
                },
            ],
        },
        {
            'name': 'Stop Loss',
            'variables': [
                {'name': 'ticker', 'type': 'string', 'label': 'Ticker Symbol', 'required': True},
                {'name': 'is_shares', 'type': 'boolean', 'label': 'Is Shares', 'required': False},
                {'name': 'strike', 'type': 'float', 'label': 'Strike', 'required': True},
                {'name': 'expiration', 'type': 'date', 'label': 'Expiration', 'required': True},
                {'name': 'option_type', 'type': 'select', 'options': ['PUT', 'CALL'], 'default': 'CALL', 'label': 'Option Type', 'required': True},
                {'name': 'price', 'type': 'float', 'label': 'Price', 'required': True},
                {'name': 'entry_price', 'type': 'float', 'label': 'Entry Price', 'required': True},
                {'name': 'exit_price', 'type': 'float', 'label': 'Exit Price', 'required': True},
                {'name': 'pnl_percent', 'type': 'float', 'label': 'P&L %', 'required': True},
            ],
            'title_template': 'üõë {{ticker}} Stop Loss HIT',
            'description_template': 'üî¥ **Trade Performance:**',
            'color': '#FF0000',
            'fileds_template': [
                {
                    'name': 'Ticker: {{ticker}}',
                    'value': '',
                    'inline': False,
                    'optional': False
                },
                {
                    'name': '‚ùå Expiration',
                    'value': '{{expiration}}',
                    'inline': True,
                    'optional': False
                },
                {
                    'name': '‚úçÔ∏è Strike',
                    'value': '{{strike}} {{option_type}}',
                    'inline': True,
                    'optional': False
                },
                {
                    'name': 'üíµ Price',
                    'value': '${{price}}',
                    'inline': True,
                    'optional': False
                },
                {
                    'name': '',
                    'value': '\u200b',
                    'inline': False,
                    'optional': False
                },
                {
                    'name': '‚úÖ Entry',
                    'value': '${{entry_price}}',
                    'inline': True,
                    'optional': False
                },
                {
                    'name': 'üõë Stop Hit',
                    'value': '${{exit_price}}',
                    'inline': True,
                    'optional': False
                },
                {
                    'name': 'üí∏ Result',
                    'value': '{{pnl_percent}}%',
                    'inline': True,
                    'optional': False
                },
                {
                    'name': '',
                    'value': '\u200b',
                    'inline': False,
                    'optional': False
                },
                {
                    'name': 'üö® __Status: Position Closed__ üö®',
                    'value': '\u200b',
                    'inline': False,
                    'optional': False
                },
                {
                    'name': 'üõ°Ô∏è Discipline Matters: Following the plan keeps you in the game for winning trades',
                    'value': '',
                    'inline': False,
                    'optional': False
                }
            ],
        },
        {
            'name': 'Take Profit',
            'variables': [
                {'name': 'ticker', 'type': 'string', 'label': 'Ticker Symbol', 'required': True},
                {'name': 'is_shares', 'type': 'boolean', 'label': 'Is Shares', 'required': False},
                {'name': 'strike', 'type': 'float', 'label': 'Strike', 'required': True},
                {'name': 'expiration', 'type': 'date', 'label': 'Expiration', 'required': True},
                {'name': 'option_type', 'type': 'select', 'options': ['PUT', 'CALL'], 'default': 'CALL', 'label': 'Option Type', 'required': True},
                {'name': 'price', 'type': 'float', 'label': 'Price', 'required': True},
                {'name': 'entry_price', 'type': 'float', 'label': 'Entry Price', 'required': True},
                {'name': 'exit_price', 'type': 'float', 'label': 'Exit Price', 'required': True},
                {'name': 'pnl_percent', 'type': 'float', 'label': 'Profit %', 'required': True},
            ],
            'title_template': 'üéØ {{ticker}} Take Profit HIT',
            'description_template': '**üü¢ Trade Performance:**',
            'color': '#00FF00',
            'fileds_template': [
                {
                    'name': 'Ticker: {{ticker}}',
                    'value': '',
                    'inline': False,
                    'optional': False
                },
                {
                    'name': '‚ùå Expiration',
                    'value': '{{expiration}}',
                    'inline': True,
                    'optional': False
                },
                {
                    'name': '‚úçÔ∏è Strike',
                    'value': '{{strike}} {{option_type}}',
                    'inline': True,
                    'optional': False
                },
                {
                    'name': 'üíµ Price',
                    'value': '${{price}}',
                    'inline': True,
                    'optional': False
                },
                {
                    'name': '',
                    'value': '\u200b',
                    'inline': False,
                    'optional': False
                },
                {
                    'name': '‚úÖ Entry',
                    'value': '${{entry_price}}',
                    'inline': True,
                    'optional': False
                },
                {
                    'name': 'üéØ TP Hit',
                    'value': '${{exit_price}}',
                    'inline': True,
                    'optional': False
                },
                {
                    'name': 'üí∏ Profit',
                    'value': '{{pnl_percent}}%',
                    'inline': True,
                    'optional': False
                },
                {
                    'name': '',
                    'value': '\u200b',
                    'inline': False,
                    'optional': False
                },
                {
                    'name': 'üö® __Status: TP Reached__ üö®',
                    'value': '',
                    'inline': False,
                    'optional': False
                },
                {
                    'name': '',
                    'value': '\u200b',
                    'inline': False,
                    'optional': False
                },
                {
                    'name': 'üîç Position Management:',
                    'value': '',
                    'inline': False,
                    'optional': False
                },
                {
                    'name': '‚úÖ Reduce position by 50% (lock in profit)',
                    'value': '',
                    'inline': False,
                    'optional': False
                },
            ]
        }
    ]
    
    for signal_type_data in default_types:
        SignalType.objects.create(**signal_type_data)


def remove_default_signal_types(apps, schema_editor):
    """Remove default signal types"""
    SignalType = apps.get_model('signals', 'SignalType')
    SignalType.objects.filter(name__in=['Entry', 'Stop Loss', 'Take Profit']).delete()


class Migration(migrations.Migration):

    dependencies = [
        ('signals', '0001_initial'),
    ]

    operations = [
        migrations.RunPython(create_default_signal_types, remove_default_signal_types),
    ]
